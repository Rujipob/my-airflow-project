[2025-10-23T17:04:20.007+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: ckan_data_etl.load manual__2025-10-23T16:57:09+00:00 [queued]>
[2025-10-23T17:04:20.018+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: ckan_data_etl.load manual__2025-10-23T16:57:09+00:00 [queued]>
[2025-10-23T17:04:20.019+0000] {taskinstance.py:1361} INFO - Starting attempt 2 of 2
[2025-10-23T17:04:20.037+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): load> on 2025-10-23 16:57:09+00:00
[2025-10-23T17:04:20.046+0000] {standard_task_runner.py:57} INFO - Started process 1091 to run task
[2025-10-23T17:04:20.053+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'ckan_data_etl', 'load', 'manual__2025-10-23T16:57:09+00:00', '--job-id', '736', '--raw', '--subdir', 'DAGS_FOLDER/crypto_etl_dag.py', '--cfg-path', '/tmp/tmpje66uu7v']
[2025-10-23T17:04:20.054+0000] {standard_task_runner.py:85} INFO - Job 736: Subtask load
[2025-10-23T17:04:20.126+0000] {task_command.py:416} INFO - Running <TaskInstance: ckan_data_etl.load manual__2025-10-23T16:57:09+00:00 [running]> on host 056dd0d0c4ba
[2025-10-23T17:04:20.213+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='ckan_data_etl' AIRFLOW_CTX_TASK_ID='load' AIRFLOW_CTX_EXECUTION_DATE='2025-10-23T16:57:09+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-10-23T16:57:09+00:00'
[2025-10-23T17:04:20.252+0000] {taskinstance.py:1937} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidSchemaName: schema "data" does not exist
LINE 2: CREATE TABLE data.recalls (
                     ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/crypto_etl_dag.py", line 46, in load_to_db
    df.to_sql('recalls', con=engine, schema='data', if_exists='replace', index=False)
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/core/generic.py", line 2878, in to_sql
    return sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 769, in to_sql
    return pandas_sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1910, in to_sql
    table = self.prep_table(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1814, in prep_table
    table.create()
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 914, in create
    self._execute_create()
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 900, in _execute_create
    self.table.create(bind=self.pd_sql.con)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/schema.py", line 962, in create
    bind._run_ddl_visitor(ddl.SchemaGenerator, self, checkfirst=checkfirst)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2221, in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/visitors.py", line 524, in traverse_single
    return meth(obj, **kw)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/ddl.py", line 899, in visit_table
    self.connection.execute(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/ddl.py", line 80, in _execute_on_connection
    return connection._execute_ddl(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1477, in _execute_ddl
    ret = self._execute_context(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidSchemaName) schema "data" does not exist
LINE 2: CREATE TABLE data.recalls (
                     ^

[SQL: 
CREATE TABLE data.recalls (
	_id BIGINT, 
	"รายการ" TEXT, 
	"สวนสัตว์" TEXT, 
	"ปีงบประมาณ" BIGINT, 
	"ต.ค. 67" TEXT, 
	"พ.ย. 67" TEXT, 
	"ธ.ค. 67" TEXT, 
	"ม.ค.68" TEXT, 
	"ก.พ. 68" TEXT, 
	"มี.ค. 68" TEXT, 
	"เม.ย. 68" TEXT, 
	"พ.ค. 68" TEXT, 
	"มิ.ย. 68" TEXT, 
	"ก.ค. 68" TEXT, 
	"ส.ค. 68" TEXT, 
	"ก.ย. 68" TEXT, 
	data_ingested_at TIMESTAMP WITHOUT TIME ZONE
)

]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2025-10-23T17:04:20.275+0000] {taskinstance.py:1400} INFO - Marking task as FAILED. dag_id=ckan_data_etl, task_id=load, execution_date=20251023T165709, start_date=20251023T170420, end_date=20251023T170420
[2025-10-23T17:04:20.291+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 736 for task load ((psycopg2.errors.InvalidSchemaName) schema "data" does not exist
LINE 2: CREATE TABLE data.recalls (
                     ^

[SQL: 
CREATE TABLE data.recalls (
	_id BIGINT, 
	"รายการ" TEXT, 
	"สวนสัตว์" TEXT, 
	"ปีงบประมาณ" BIGINT, 
	"ต.ค. 67" TEXT, 
	"พ.ย. 67" TEXT, 
	"ธ.ค. 67" TEXT, 
	"ม.ค.68" TEXT, 
	"ก.พ. 68" TEXT, 
	"มี.ค. 68" TEXT, 
	"เม.ย. 68" TEXT, 
	"พ.ค. 68" TEXT, 
	"มิ.ย. 68" TEXT, 
	"ก.ค. 68" TEXT, 
	"ส.ค. 68" TEXT, 
	"ก.ย. 68" TEXT, 
	data_ingested_at TIMESTAMP WITHOUT TIME ZONE
)

]
(Background on this error at: https://sqlalche.me/e/14/f405); 1091)
[2025-10-23T17:04:20.345+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2025-10-23T17:04:20.366+0000] {taskinstance.py:2778} INFO - 0 downstream tasks scheduled from follow-on schedule check
